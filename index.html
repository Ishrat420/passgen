<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Custom Password Generator</title>
  <style>
    body {
      background-color: #eeeeee;
      color: #111;
      font-family: 'Courier New', Courier, monospace;
      padding: 2rem;
      max-width: 500px;
      margin: auto;
    }

    h2 {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    label {
      display: block;
      margin-top: 1rem;
      font-weight: bold;
    }

    input, select, button {
      width: 100%;
      padding: 0.8rem;
      margin-top: 0.3rem;
      font-family: inherit;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }

    button {
      background-color: #222;
      color: white;
      cursor: pointer;
      margin-top: 1.5rem;
    }

    button:hover {
      background-color: #444;
    }

    #result {
      margin-top: 2rem;
      padding: 1rem;
      background: white;
      border: 1px solid #ccc;
      border-radius: 5px;
      text-align: center;
      word-break: break-word;
      font-size: 1.2rem;
      position: relative;
    }

    #copyBtn {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      width: auto;
      padding: 0.5rem 1rem;
    }

    @media (max-width: 600px) {
      body {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>
  <h2>Custom Password Generator</h2>

  <label for="website">Website or App Name:</label>
  <input type="text" id="website" placeholder="e.g. facebook.com" />

  <label for="secret">Your Secret/Salt:</label>
  <input type="text" id="secret" placeholder="e.g. ChottoMate!42" />

  <label for="counter">Counter (for rotation):</label>
  <input type="number" id="counter" value="0" min="0" />

  <label for="algorithm">Hashing/Encoding Method:</label>
  <select id="algorithm">
    <optgroup label="Secure (Recommended)">
      <option value="PBKDF2-SHA256" selected>PBKDF2-SHA256 (default)</option>
      <option value="SHA-256">SHA-256</option>
      <option value="SHA-512">SHA-512</option>
    </optgroup>
    <optgroup label="Legacy / Fun">
      <option value="SHA-1">SHA-1</option>
      <option value="MD5">MD5</option>
      <option value="Base64">Base64</option>
    </optgroup>
  </select>

  <label for="length">Characters to Use from Result:</label>
  <input type="number" id="length" value="12" min="4" max="50" />

  <label for="suffix">Optional Suffix:</label>
  <input type="text" id="suffix" placeholder="e.g. UpLow123! (optional)" />

  <button onclick="generate()">Generate Password</button>

  <div id="result" style="display:none;">
    <span id="password"></span><br />
    <button id="copyBtn" onclick="copyToClipboard()">Copy</button>
  </div>

  <script>
    // Helper: normalize site input
    function normalizeSite(site) {
      try {
        let url = site.trim();
        if (!url.includes("://")) url = "https://" + url;
        const hostname = new URL(url).hostname.toLowerCase();
        return hostname.replace(/^www\./, "");
      } catch (e) {
        return site.trim().toLowerCase();
      }
    }

    // MD5 fallback using CryptoJS
    function md5(input) {
      return CryptoJS.MD5(input).toString();
    }

    // Base64 encoder (UTF-8 safe)
    function base64Encode(str) {
      return btoa(unescape(encodeURIComponent(str)));
    }

    async function pbkdf2(password, salt, iterations = 100000, keyLen = 32) {
      const enc = new TextEncoder();
      const keyMaterial = await crypto.subtle.importKey(
        "raw", enc.encode(password), "PBKDF2", false, ["deriveBits"]
      );
      const bits = await crypto.subtle.deriveBits(
        {
          name: "PBKDF2",
          salt: enc.encode(salt),
          iterations: iterations,
          hash: "SHA-256"
        },
        keyMaterial,
        keyLen * 8
      );
      return Array.from(new Uint8Array(bits))
        .map(b => b.toString(16).padStart(2, "0"))
        .join("");
    }

    async function hash(input, algorithm) {
      const encoder = new TextEncoder();
      const data = encoder.encode(input);
      const hashBuffer = await crypto.subtle.digest(algorithm, data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, "0")).join("");
    }

    async function generate() {
      const website = document.getElementById("website").value.trim();
      const secret = document.getElementById("secret").value.trim();
      const counter = document.getElementById("counter").value.trim() || "0";
      const algorithm = document.getElementById("algorithm").value;
      const suffix = document.getElementById("suffix").value || "";
      const length = parseInt(document.getElementById("length").value, 10);
      const resultDiv = document.getElementById("result");
      const passwordSpan = document.getElementById("password");

      if (!website || !secret) {
        resultDiv.style.display = "block";
        passwordSpan.innerText = "Please enter website and secret.";
        return;
      }

      const normalizedSite = normalizeSite(website);
      const combinedInput = `${normalizedSite}|${secret}|${counter}`;
      let finalResult = "";

      try {
        if (algorithm === "PBKDF2-SHA256") {
          finalResult = await pbkdf2(secret, combinedInput);
        } else if (algorithm === "MD5") {
          finalResult = md5(combinedInput);
        } else if (algorithm === "Base64") {
          finalResult = base64Encode(combinedInput);
        } else {
          finalResult = await hash(combinedInput, algorithm);
        }

        const password = finalResult.slice(0, length) + suffix;
        resultDiv.style.display = "block";
        passwordSpan.innerText = password;
      } catch (error) {
        resultDiv.style.display = "block";
        passwordSpan.innerText = "Error: " + error;
      }
    }

    function copyToClipboard() {
      const password = document.getElementById("password").innerText;
      navigator.clipboard.writeText(password).then(() => {
        const btn = document.getElementById("copyBtn");
        const original = btn.innerText;
        btn.innerText = "Copied!";
        setTimeout(() => {
          btn.innerText = original;
        }, 2000);
      });
    }
  </script>

  <!-- Load CryptoJS MD5 support -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</body>
</html>
