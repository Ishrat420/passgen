<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="https://cdn.jsdelivr.net/npm/localforage@1.10.0/dist/localforage.min.js"></script>
  <title>Deterministic Password Generator</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <main class="app-shell">
  <h2>Custom Password Generator</h2>

  <label>Website or App Name:</label>
  <input id="website" placeholder="e.g. facebook.com">

      <label for="master-key">Your Secret / Master Phrase:
          <span class="info-tip" data-tip="This is your master phrase/key, remember it and keep it secret! We don't Store it here. ">?</span>
      </label>
  <input id="secret" placeholder="e.g. ChottoMate!42">

      <label for="counter">Version Counter (for rotation):
          <span class="info-tip" data-tip="Used when generating multiple passwords for the same site, increment to get a new one.">?</span>
      </label>
  <input type="number" id="counter" value="0" min="0">


      <label for="algo-label">Algorithm:
          <span class="info-tip" data-tip="The cryptographic method used to derive your password.">?</span>
      </label>
  <select id="algorithm">
    <optgroup label="Secure (Recommended)">
      <option value="PBKDF2-SHA256" selected>PBKDF2-SHA256 (default)</option>
      <option value="Argon2id">Argon2id</option>
      <option value="scrypt">scrypt</option>
    </optgroup>
    <optgroup label="Simple">
      <option value="SHA-256">SHA-256</option>
      <option value="SHA-512">SHA-512</option>
    </optgroup>
  </select>

  <label>Character length</label>
  <input type="number" id="length" value="16" min="8" max="50">

      <!-- Character Policy Toggle -->
      <div class="toggle-row">
        <label class="switch">
          <input type="checkbox" id="policyToggle" checked>
          <span class="slider"></span>
        </label>
        <label for="policyToggle" class="switch-label">Include upper, lower, digit & symbol</label>
      </div>
      <small id="policyHint" class="hint" style="display:none;">Disabled while Compatibility Mode is on</small>

      <!-- Compatibility Mode Toggle -->
      <div class="toggle-row">
        <label class="switch">
          <input type="checkbox" id="compatToggle">
          <span class="slider"></span>
        </label>
        <label for="compatToggle" class="switch-label">Compatibility Mode (Safe Charset)</label>
      </div>
      <small id="compatHint" class="hint" style="display:none;">Disabled while Character Policy is on</small>


  <button id="generateBtn" type="button">Generate Password</button>
  <small id="registryMessage" class="info-msg" style="display:none; color:#777; margin-top:6px; font-style:italic;"></small>

  <div id="result" style="display:none;">
    <span id="password"></span><br>
    <button id="copyBtn" type="button">Copy</button><br>
    <small id="recipeInfo"></small><br>
    <small id="diversityWarning" style="display:none; color:#d33; font-weight:bold;"></small><br>
    <button id="explainBtn" type="button">üîç Explain My Password</button>
    <div id="explainBox"></div>
  </div>

  <details>
    <summary>Advanced Options ‚öôÔ∏è</summary>
    <label>PBKDF2 Iterations:</label><input type="number" id="iterations" value="100000" min="10000">
    <label>Argon2 Memory (MB):</label><input type="number" id="argonMem" value="64" min="8">
    <label>scrypt N (CPU cost):</label><input type="number" id="scryptN" value="16384" min="1024">
    <button id="resetAppBtn" class="danger-btn">Reset All App Data</button>
    <small style="display:block;margin-top:4px;color:#666;">
    Clears all stored recipes, registry history, and preferences.
    </small>
  </details>
  <hr>

  <details id="history" open>
    <summary>üîê Saved Recipes</summary>

    <div class="history-controls">
      <input
        type="text"
        id="searchHistory"
        placeholder="Search by site..."
        class="search-box"
      />
      <div class="history-buttons">
        <button id="syncBtn">Sync via QR</button>
        <button id="exportBtn">Export JSON</button>
        <button id="importBtn">Import JSON</button>
        <button id="clearHistoryBtn">Clear All</button>
      </div>
    </div>

    <ul id="historyList" class="history-list"></ul>
    <small id="storageInfo" style="color:#555;"></small>
  </details>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/argon2-browser/dist/argon2-bundled.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/scrypt-js@3.0.1/scrypt.min.js"></script>
  <script src="js/vendor/qrcode.js"></script>
  <div id="syncModal" class="sync-modal hidden" role="dialog" aria-modal="true" aria-labelledby="syncModalTitle">
    <div class="sync-modal__dialog">
      <header class="sync-modal__header">
        <h3 id="syncModalTitle" class="sync-modal__title">Device Sync</h3>
        <button type="button" class="sync-modal__close" aria-label="Close">√ó</button>
      </header>
      <p class="sync-modal__subtitle">Reconnect devices without the cloud. Use a shared passphrase to protect your data.</p>
      <div id="syncToast" class="sync-toast" role="alert" aria-live="assertive"></div>
      <div class="sync-mode">
        <button type="button" class="sync-mode__btn sync-mode__btn--active" data-mode="send">Send</button>
        <button type="button" class="sync-mode__btn" data-mode="receive">Receive</button>
      </div>
      <section id="syncQuickSendPanel" class="sync-panel" aria-live="polite">
        <div class="sync-step">
          <h4 class="sync-step__title">Step 1 ‚Äî Share this passphrase</h4>
          <p class="sync-panel__hint">Read or send this passphrase to the other device. It protects your snapshot end-to-end.</p>
          <div class="sync-secret">
            <code id="syncQuickPassphrase" class="sync-secret__value">‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî</code>
            <div class="sync-actions sync-actions--inline">
              <button type="button" id="syncQuickCopyPassphraseBtn">Copy Passphrase</button>
              <button type="button" id="syncQuickRegenerateBtn">New Passphrase</button>
            </div>
          </div>
        </div>
        <div class="sync-step">
          <h4 class="sync-step__title">Step 2 ‚Äî Share encrypted bundle</h4>
          <p class="sync-panel__hint">Show the QR or copy the payload once the receiver confirms the passphrase.</p>
          <canvas id="syncQuickQr" class="sync-qr"></canvas>
          <textarea id="syncQuickPayload" class="sync-payload" readonly placeholder="Encrypted bundle appears here"></textarea>
          <div class="sync-actions">
            <button type="button" id="syncCopyQuickPayloadBtn">Copy Bundle</button>
          </div>
        </div>
        <div id="syncQuickStatus" class="sync-status" role="status" aria-live="polite"></div>
        <small class="sync-footnote">Quick transfers trade the audible code for a strong passphrase. Regenerate when you close this window.</small>
      </section>

      <section id="syncQuickReceivePanel" class="sync-panel hidden">
        <div class="sync-step">
          <h4 class="sync-step__title">Step 1 ‚Äî Enter shared passphrase</h4>
          <label class="sync-label" for="syncQuickPassphraseInput">Passphrase from sender</label>
          <input id="syncQuickPassphraseInput" class="sync-code" type="text" inputmode="latin" autocomplete="off" placeholder="XXXX-XXXX-XXXX-XXXX" spellcheck="false" />
        </div>
        <div class="sync-step">
          <h4 class="sync-step__title">Step 2 ‚Äî Paste encrypted bundle</h4>
          <textarea id="syncQuickInput" class="sync-payload" placeholder="Paste encrypted bundle from sender"></textarea>
          <div class="sync-actions">
            <button type="button" id="syncQuickScanBtn" aria-label="Scan QR code to fill encrypted bundle">üì∑ Scan QR</button>
            <button type="button" id="syncQuickImportBtn">Import Bundle</button>
          </div>
        </div>
        <div id="syncQuickImportStatus" class="sync-status" role="status" aria-live="polite"></div>
        <small class="sync-footnote">Never reuse passphrases. Once imported, ask the sender to close their window to discard keys.</small>
      </section>
      <div id="syncQuickScanner" class="sync-scanner hidden" role="dialog" aria-modal="true" aria-labelledby="syncQuickScannerTitle">
        <div class="sync-scanner__panel">
          <div class="sync-scanner__header">
            <h5 id="syncQuickScannerTitle">Scan sender QR</h5>
            <button type="button" id="syncQuickScannerClose" class="sync-scanner__close" aria-label="Close QR scanner">√ó</button>
          </div>
          <video id="syncQuickScannerVideo" class="sync-scanner__video" autoplay playsinline muted></video>
          <p id="syncQuickScannerStatus" class="sync-scanner__status">Allow camera access and point it at the sender QR.</p>
        </div>
      </div>
    </div>
  </div>
  <script type="module" src="js/ui.js"></script>
  <footer id="appVersion">PasswordGen v2.0 ‚Äî 100% Local, No Cloud</footer>
  </main>
</body>
</html>
