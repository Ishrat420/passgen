<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="https://cdn.jsdelivr.net/npm/localforage@1.10.0/dist/localforage.min.js"></script>
  <title>Deterministic Password Generator</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <main class="app-shell">
    <header class="app-header">
      <p class="app-header__eyebrow">Deterministic passwords</p>
      <h1 class="app-header__title">Custom Password Generator</h1>
      <p class="app-header__subtitle">A site-specific password generator that always gives you the same password for each site.</p>
    </header>

    <section class="app-card generator-card">
      <div class="section-heading">
        <h2>Recipe Inputs</h2>
        <p>Fill these once and regenerate on any device.</p>
      </div>

      <div class="field-group">
        <label class="field-label" for="website">Website or App Name</label>
        <input id="website" class="field-input" placeholder="e.g. facebook.com">
      </div>

      <div class="field-group">
        <label class="field-label" for="secret">Your Secret / Master Phrase
          <span class="info-tip" data-tip="This is your master phrase/key, remember it and keep it secret! We don't Store it here.">?</span>
        </label>
        <input id="secret" class="field-input" placeholder="e.g. ChottoMate!42" aria-describedby="secretError">
        <small id="secretError" class="field-error" role="alert" aria-live="polite"></small>
      </div>

      <div class="field-grid">
        <div class="field-group">
          <label class="field-label" for="counter">Password Counter
            <span class="info-tip" data-tip="Starts with 0, Bump this up if you need a new password for the same site!">?</span>
          </label>
          <input type="number" id="counter" class="field-input" value="0" min="0">
        </div>
        <div class="field-group">
          <label class="field-label" for="length">Character Length</label>
          <input type="number" id="length" class="field-input" value="16" min="8" max="50">
        </div>
      </div>

      <div class="field-group">
        <label class="field-label" for="algorithm">Algorithm
          <span class="info-tip" data-tip="The cryptographic method used to derive your password.">?</span>
        </label>
        <div class="select-wrapper">
          <select id="algorithm" class="field-input">
            <optgroup label="Secure (Recommended)">
              <option value="PBKDF2-SHA256" selected>PBKDF2-SHA256 (default)</option>
              <option value="Argon2id">Argon2id</option>
              <option value="scrypt">scrypt</option>
              <option value="Balloon-SHA256">Balloon-SHA256</option>
            </optgroup>
            <optgroup label="Simple">
              <option value="SHA-256">SHA-256</option>
              <option value="SHA-512">SHA-512</option>
              <option value="BLAKE2b-512">BLAKE2b-512</option>
              <option value="BLAKE2s-256">BLAKE2s-256</option>
              <option value="HMAC-SHA256">HMAC-SHA256</option>
            </optgroup>
          </select>
        </div>
      </div>

      <div class="setting-stack" role="group" aria-labelledby="quickSettingsHeading">
        <h3 id="quickSettingsHeading" class="section-subheading">Quick Settings</h3>

        <div class="setting-row">
          <div class="setting-copy">
            <span class="setting-title">Character Policy</span>
            <span class="setting-description">Include upper, lower, digit & symbol</span>
          </div>
          <label class="switch" for="policyToggle">
            <input type="checkbox" id="policyToggle" checked>
            <span class="slider"></span>
          </label>
        </div>
        <small id="policyHint" class="hint" style="display:none;">Disabled while Compatibility Mode is on</small>

        <div class="setting-row">
          <div class="setting-copy">
            <span class="setting-title">Compatibility Mode</span>
            <span class="setting-description">Use this mode for sites that reject certain special characters.</span>
          </div>
          <label class="switch" for="compatToggle">
            <input type="checkbox" id="compatToggle">
            <span class="slider"></span>
          </label>
        </div>
        <small id="compatHint" class="hint" style="display:none;">Disabled while Character Policy is on</small>
      </div>

      <div class="action-bar">
        <button id="generateBtn" class="primary-action" type="button">Generate Password</button>
        <small id="registryMessage" class="info-msg" style="display:none;">&nbsp;</small>
      </div>
    </section>

    <section class="app-card result-card">
      <div class="section-heading">
        <h2>Latest Password</h2>
        <p>Copy it quickly before it hides itself.</p>
      </div>
      <div id="result" class="result-panel" style="display:none;">
        <span id="password"></span>
        <div class="result-actions">
          <button id="copyBtn" type="button">Copy</button>
          <small id="recipeInfo"></small>
          <small id="diversityWarning" style="display:none;">‚ö†Ô∏è Password lacks full character diversity.</small>
          <button id="explainBtn" type="button">üîç Explain My Password</button>
        </div>
        <div id="explainBox"></div>
      </div>
    </section>

    <section class="app-card advanced-card">
      <details>
        <summary>Advanced Options ‚öôÔ∏è</summary>
        <div class="advanced-grid">
          <div class="field-group">
            <label class="field-label" for="iterations">PBKDF2 Iterations</label>
            <input type="number" id="iterations" class="field-input" value="100000" min="10000">
          </div>
          <div class="field-group">
            <label class="field-label" for="argonMem">Argon2 Memory (MB)</label>
            <input type="number" id="argonMem" class="field-input" value="64" min="8">
          </div>
          <div class="field-group">
            <label class="field-label" for="scryptN">scrypt N (CPU cost)</label>
            <input type="number" id="scryptN" class="field-input" value="16384" min="1024">
          </div>
          <div class="field-group">
            <label class="field-label" for="balloonSpace">Balloon Space Cost</label>
            <input type="number" id="balloonSpace" class="field-input" value="64" min="4">
          </div>
          <div class="field-group">
            <label class="field-label" for="balloonTime">Balloon Time Cost</label>
            <input type="number" id="balloonTime" class="field-input" value="3" min="1">
          </div>
          <div class="field-group">
            <label class="field-label" for="balloonDelta">Balloon Mixing Rounds (Œî)</label>
            <input type="number" id="balloonDelta" class="field-input" value="3" min="1">
          </div>
        </div>
        <button id="resetAppBtn" class="danger-btn" type="button">Reset All App Data</button>
        <small class="advanced-hint">
          Clears all stored recipes, registry history, and preferences.
        </small>
      </details>
    </section>

    <section class="app-card history-sheet">
      <details id="history" open>
        <summary>üîê Saved Recipes</summary>

        <div class="history-controls">
          <input
            type="text"
            id="searchHistory"
            placeholder="Search by site..."
            class="search-box"
          />
          <div class="history-buttons">
            <button id="syncBtn" type="button">Sync via QR</button>
            <button id="exportBtn" type="button">Export JSON</button>
            <button id="importBtn" type="button">Import JSON</button>
            <button id="clearHistoryBtn" type="button">Clear All</button>
          </div>
        </div>

        <ul id="historyList" class="history-list"></ul>
        <small id="storageInfo" class="history-footnote"></small>
      </details>
    </section>
    <footer id="appVersion">PasswordGen v2.0 ‚Äî 100% Local, No Cloud</footer>
  </main>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/argon2-browser/dist/argon2-bundled.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/scrypt-js@3.0.1/scrypt.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/blakejs@1.2.1/blake.min.js" crossorigin="anonymous"></script>
  <script>
    if (!window.blakejs) {
      document.write(
        '<script src="https://unpkg.com/blakejs@1.2.1/blakejs.min.js" crossorigin="anonymous"><\\/script>'
      );
    }
  </script>
  <script>
    if (!window.blakejs) {
      document.write(
        '<script src="https://cdnjs.cloudflare.com/ajax/libs/blakejs/1.2.1/blakejs.min.js" crossorigin="anonymous"><\\/script>'
      );
    }
  </script>
  <script>
    if (!window.blakejs) {
      console.warn('BLAKE2 support is still unavailable after trying all CDN mirrors.');
    }
  </script>
  <script src="js/vendor/qrcode.js"></script>
  <div id="syncModal" class="sync-modal hidden" role="dialog" aria-modal="true" aria-labelledby="syncModalTitle">
    <div class="sync-modal__dialog">
      <header class="sync-modal__header">
        <h3 id="syncModalTitle" class="sync-modal__title">Device Sync</h3>
        <button type="button" class="sync-modal__close" aria-label="Close">√ó</button>
      </header>
      <p class="sync-modal__subtitle">Reconnect devices without the cloud. Use a shared passphrase to protect your data.</p>
      <div id="syncToast" class="sync-toast" role="alert" aria-live="assertive"></div>
      <div class="sync-mode">
        <button type="button" class="sync-mode__btn sync-mode__btn--active" data-mode="send">Send</button>
        <button type="button" class="sync-mode__btn" data-mode="receive">Receive</button>
      </div>
      <section id="syncQuickSendPanel" class="sync-panel" aria-live="polite">
        <div class="sync-step">
          <h4 class="sync-step__title">Step 1 ‚Äî Share this passphrase</h4>
          <p class="sync-panel__hint">Read or send this passphrase to the other device. It protects your snapshot end-to-end.</p>
          <div class="sync-secret">
            <code id="syncQuickPassphrase" class="sync-secret__value">‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî</code>
            <div class="sync-actions sync-actions--inline">
              <button type="button" id="syncQuickCopyPassphraseBtn">Copy Passphrase</button>
              <button type="button" id="syncQuickRegenerateBtn">New Passphrase</button>
            </div>
          </div>
        </div>
        <div class="sync-step">
          <h4 class="sync-step__title">Step 2 ‚Äî Share encrypted bundle</h4>
          <p class="sync-panel__hint">Show the QR or copy the payload once the receiver confirms the passphrase.</p>
          <canvas id="syncQuickQr" class="sync-qr"></canvas>
          <textarea id="syncQuickPayload" class="sync-payload" readonly placeholder="Encrypted bundle appears here"></textarea>
          <div class="sync-actions">
            <button type="button" id="syncCopyQuickPayloadBtn">Copy Bundle</button>
          </div>
        </div>
        <div id="syncQuickStatus" class="sync-status" role="status" aria-live="polite"></div>
        <small class="sync-footnote">Quick transfers trade the audible code for a strong passphrase. Regenerate when you close this window.</small>
      </section>

      <section id="syncQuickReceivePanel" class="sync-panel hidden">
        <div class="sync-step">
          <h4 class="sync-step__title">Step 1 ‚Äî Enter shared passphrase</h4>
          <label class="sync-label" for="syncQuickPassphraseInput">Passphrase from sender</label>
          <input id="syncQuickPassphraseInput" class="sync-code" type="text" inputmode="latin" autocomplete="off" placeholder="XXXX-XXXX-XXXX-XXXX" spellcheck="false" />
        </div>
        <div class="sync-step">
          <h4 class="sync-step__title">Step 2 ‚Äî Paste encrypted bundle</h4>
          <textarea id="syncQuickInput" class="sync-payload" placeholder="Paste encrypted bundle from sender"></textarea>
          <div class="sync-actions">
            <button type="button" id="syncQuickScanBtn" aria-label="Scan QR code to fill encrypted bundle">üì∑ Scan QR</button>
            <button type="button" id="syncQuickImportBtn">Import Bundle</button>
          </div>
        </div>
        <div id="syncQuickImportStatus" class="sync-status" role="status" aria-live="polite"></div>
        <small class="sync-footnote">Never reuse passphrases. Once imported, ask the sender to close their window to discard keys.</small>
      </section>
      <div id="syncQuickScanner" class="sync-scanner hidden" role="dialog" aria-modal="true" aria-labelledby="syncQuickScannerTitle">
        <div class="sync-scanner__panel">
          <div class="sync-scanner__header">
            <h5 id="syncQuickScannerTitle">Scan sender QR</h5>
            <button type="button" id="syncQuickScannerClose" class="sync-scanner__close" aria-label="Close QR scanner">√ó</button>
          </div>
          <video id="syncQuickScannerVideo" class="sync-scanner__video" autoplay playsinline muted></video>
          <p id="syncQuickScannerStatus" class="sync-scanner__status">Allow camera access and point it at the sender QR.</p>
        </div>
      </div>
    </div>
  </div>
  <script type="module" src="js/ui.js"></script>
</body>
</html>
